<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday</title>

<style>
@import url("https://fonts.googleapis.com/css?family=Lato:300italic");

html,body{
  width:100%;
  height:100%;
  margin:0;
  overflow:hidden;
  background:radial-gradient(circle at top,#2b6cb0 0%,#0b2a4a 55%,#061a2e 100%);
  display:flex;
  align-items:center;
  justify-content:center;
}

.wrap{
  width:min(420px,92vw);
  text-align:center;
  color:#eaf4ff;
}

.name{
  font-size:1.1rem;
  font-weight:700;
  letter-spacing:.4px;
}

#cake{
  display:block;
  margin:0 auto;
}

/* ===== Candle ===== */
.candle{
  background:#fff;
  border-radius:10px;
  position:absolute;
  top:210px;
  left:50%;
  width:6px;
  height:36px;
  margin-left:-3px;
  animation:drop .6s ease forwards;
  z-index:5;
}
.candle:before,.candle:after{
  content:"";
  position:absolute;
  width:100%;
  height:3px;
  background:rgba(255,0,0,.4);
}
.candle:before{top:30%}
.candle:after{top:55%}

/* ===== Fire ===== */
.fuego{
  position:absolute;
  top:-22px;
  left:50%;
  width:8px;
  height:20px;
  margin-left:-4px;
  border-radius:50%;
  animation:fuego 1.2s infinite;
}
body.blown .fuego{
  opacity:0;
  transform:translateY(12px) scale(.5);
  animation:none;
}

@keyframes fuego{
  0%,100%{
    background:rgba(255,230,100,.6);
    box-shadow:0 0 20px 6px rgba(255,220,150,.3);
    transform:translateY(0);
  }
  50%{
    background:rgba(255,80,0,.2);
    transform:translateY(-18px) scale(.2);
  }
}

@keyframes drop{
  from{transform:translateY(-200px)}
  to{transform:translateY(0)}
}

/* ===== Text ===== */
.text{
  font-family:Lato,sans-serif;
  font-style:italic;
  margin-top:10px;
}
.text h1{
  margin:10px 0 6px;
  font-size:1.6em;
}

/* ===== Panel ===== */
.panel{
  margin-top:14px;
  background:rgba(255,255,255,.1);
  border:1px solid rgba(255,255,255,.15);
  border-radius:14px;
  padding:12px;
  backdrop-filter:blur(6px);
}
button{
  border:none;
  border-radius:10px;
  padding:10px 14px;
  font-weight:700;
  cursor:pointer;
}
#micBtn{background:#2dd4bf;color:#06202b}
#relightBtn{background:rgba(255,255,255,.15);color:#fff}

.meter{
  height:10px;
  background:rgba(255,255,255,.2);
  border-radius:999px;
  overflow:hidden;
}
.meter div{
  height:100%;
  width:0%;
  background:#ffd166;
}
</style>
</head>

<body>
<div class="wrap">

<div class="candle">
  <div class="fuego"></div>
</div>

<!-- ===== FULL SVG CAKE ===== -->
<svg id="cake" width="200" height="460" viewBox="0 0 200 460">
  <rect x="10" y="390" width="180" height="10" fill="#fefae9"/>
  <path fill="#a88679" d="M20 380h160c0-20-160-20-160 0z"/>
  <path fill="#8b6a60" d="M30 340h140v40H30z"/>
  <path fill="#a88679" d="M30 300h140v40H30z"/>
  <path fill="#8b6a60" d="M30 260h140v40H30z"/>
  <path fill="#fefae9" d="M30 260c0 20 20 20 20 0s20-20 20 0 20 20 20 0 20-20 20 0 20 20 20 0 20-20 20 0v20H30z"/>
</svg>

<div class="text">
  <h1>happy birthday!</h1>
  <p class="name">LÃŠ VÄ‚N Lá»˜C</p>
</div>

<div class="panel">
  <button id="micBtn">ðŸŽ¤ Enable mic</button>
  <button id="relightBtn">âœ¨ Relight</button>
  <div style="height:8px"></div>
  <div class="meter"><div id="bar"></div></div>
</div>

</div>

<script>
let blown=false;
const bar=document.getElementById("bar");

document.getElementById("relightBtn").onclick=()=>{
  blown=false;
  document.body.classList.remove("blown");
};

document.getElementById("micBtn").onclick=async()=>{
  const stream=await navigator.mediaDevices.getUserMedia({audio:true});
  const ctx=new AudioContext();
  const src=ctx.createMediaStreamSource(stream);
  const analyser=ctx.createAnalyser();
  analyser.fftSize=1024;
  src.connect(analyser);
  const data=new Uint8Array(analyser.fftSize);

  function loop(){
    analyser.getByteTimeDomainData(data);
    let sum=0;
    for(let i=0;i<data.length;i++){
      const v=(data[i]-128)/128;
      sum+=v*v;
    }
    const level=Math.sqrt(sum/data.length)*150;
    bar.style.width=Math.min(level,100)+"%";

    if(level>30 && !blown){
      blown=true;
      document.body.classList.add("blown");
    }
    requestAnimationFrame(loop);
  }
  loop();
};
</script>

</body>
</html>
